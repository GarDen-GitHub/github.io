<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- スマホ対応 -->
  <title>Rasiel Search Mobile - Data</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; }
    #data-container { display: none; }
    #update-time { text-align: center; font-size: 14px; color: gray; }
    table { width: 100%; border-collapse: collapse; overflow-x: auto; display: block; } /* スマホでスクロール可能 */
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    @media (max-width: 600px) { body { padding: 10px; } table { font-size: 12px; } }
    #loading { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); text-align: center; padding-top: 200px; font-size: 18px; z-index: 1000; }
  </style>
</head>
<body>
  <div id="data-container">
    <h2>Rasiel Search Mobile</h2>
    <p id="update-time"></p> <!-- 更新日時表示 -->
    <table id="data-table">
      <thead id="table-head"></thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>
  
  <div id="loading">店舗データ読込中...</div> <!-- ローディング表示 -->

  <script>
    // ログイン状態チェック（未ログインならindex.htmlに戻す）
    if (localStorage.getItem('loggedIn') !== 'true') {
      window.location.href = 'index.html';
    } else {
      document.getElementById('data-container').style.display = 'block';
      fetchData();
    }

    // データ取得と表示
    function fetchData() {
      const apiUrl = 'https://script.google.com/macros/s/[あなたのApps Script URL]/exec';  // Apps ScriptのURLを置き換え
      
      // ローディング表示
      document.getElementById('loading').style.display = 'block';
      
      fetch(apiUrl)
        .then(response => response.json())
        .then(responseData => {
          const data = responseData.data;
          const updateTime = responseData.updateTime;
          
          // 更新日時表示
          document.getElementById('update-time').innerHTML = `データ更新日時: ${updateTime}`;
          
          if (data.length === 0) {
            document.getElementById('table-body').innerHTML = '<tr><td colspan="100%">データがありません。</td></tr>';
          } else {
            // ヘッダー作成
            const headers = Object.keys(data[0]);
            let headerRow = '<tr>';
            headers.forEach(header => {
              headerRow += `<th>${header}</th>`;
            });
            headerRow += '</tr>';
            document.getElementById('table-head').innerHTML = headerRow;
            
            // ボディ作成
            let bodyRows = '';
            data.forEach(row => {
              bodyRows += '<tr>';
              headers.forEach(header => {
                bodyRows += `<td>${row[header] || ''}</td>`;
              });
              bodyRows += '</tr>';
            });
            document.getElementById('table-body').innerHTML = bodyRows;
          }
          
          // ローディング非表示
          document.getElementById('loading').style.display = 'none';
        })
        .catch(error => {
          console.error('Error:', error);
          document.getElementById('table-body').innerHTML = '<tr><td colspan="100%">データの取得に失敗しました。</td></tr>';
          // ローディング非表示
          document.getElementById('loading').style.display = 'none';
        });
    }
  </script>
</body>
</html>
